(()=>{async function $(){try{let n=await(await fetch("/api/auth/me",{credentials:"include"})).json();return n.loggedIn&&n.user?n.user:null}catch(t){return null}}async function f(){try{return(await(await fetch(`${window.location.origin}/api/csrf-token`,{credentials:"include"})).json()).csrfToken}catch(t){return console.error("CSRF-Token konnte nicht geladen werden",t),null}}function m(t,n="success",s=3e3,r=null){let o=document.getElementById("toast");if(!o)return;o.innerHTML="";let e=document.createElement("span");if(e.textContent=t,o.appendChild(e),r){let a=document.createElement("button");a.textContent="R\xFCckg\xE4ngig",a.className="ml-4 px-3 py-1 rounded bg-white/80 text-green-700 font-bold shadow hover:bg-green-100 transition text-xs",a.onclick=()=>{r(),o.classList.add("opacity-0")},o.appendChild(a)}o.className=`fixed left-1/2 top-6 z-50 -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-center text-sm font-semibold transition-opacity duration-300 pointer-events-none ${n==="error"?"bg-red-600":"bg-green-600"} text-white opacity-100`,r||setTimeout(()=>{o.classList.add("opacity-0")},s)}function g(t=!0){let n=document.getElementById("loader");n&&n.classList.toggle("hidden",!t)}function O(){var a,c;let t=((c=(a=document.getElementById("purchase-search"))==null?void 0:a.value)==null?void 0:c.toLowerCase())||"",n=(window.allPurchasesCache||[]).filter(i=>{var u,d;return((u=i.product_name)==null?void 0:u.toLowerCase().includes(t))||((d=i.user_name)==null?void 0:d.toLowerCase().includes(t))}),s=["Datum,Produkt,Nutzer,Menge,Preis"];n.forEach(i=>{s.push(`"${(i.created_at||"").replace(/"/g,'""')}","${(i.product_name||"").replace(/"/g,'""')}","${(i.user_name||"").replace(/"/g,'""')}",${i.quantity||1},${i.price?i.price.toFixed(2):""}`)});let r=new Blob([s.join(`
`)],{type:"text/csv"}),o=URL.createObjectURL(r),e=document.createElement("a");e.href=o,e.download="kaeufe.csv",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(o)}function E(){var r,o;let t=((o=(r=document.getElementById("user-search"))==null?void 0:r.value)==null?void 0:o.toLowerCase())||"",n=document.getElementById("user-manage-list");if(!n)return;let s=(window.allUsersCache||[]).filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t));n.innerHTML="",s.forEach(e=>{let a=document.createElement("li");a.className="border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-xl p-3 shadow-sm mb-2 flex flex-col sm:flex-row sm:items-center justify-between",a.innerHTML=`
      <span class="flex-1 font-semibold">${e.name} (${e.email})</span>
    <span class="font-bold ${e.balance<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"} mr-4">${e.balance.toFixed(2)} \u20AC</span>
      <div class="flex gap-2 mt-2 sm:mt-0">
        <button class="bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 text-xs edit-user-btn" data-id="${e.id}" data-name="${e.name}">Bearbeiten</button>
        <button class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 text-xs delete-user-btn" data-id="${e.id}">L\xF6schen</button>
      </div>
    `,n.appendChild(a)}),n.onclick=function(e){let a=e.target.closest(".edit-user-btn");if(a){let i=a.dataset.id,u=a.dataset.name;J(i,u);return}let c=e.target.closest(".delete-user-btn");if(c){let i=c.dataset.id;confirm("Diesen Nutzer wirklich l\xF6schen?")&&deleteUser(i);return}}}function y(){var r,o;let t=((o=(r=document.getElementById("purchase-search"))==null?void 0:r.value)==null?void 0:o.toLowerCase())||"",n=document.getElementById("purchase-history");if(!n)return;let s=(window.allPurchasesCache||[]).filter(e=>{var a,c;return((a=e.product_name)==null?void 0:a.toLowerCase().includes(t))||((c=e.user_name)==null?void 0:c.toLowerCase().includes(t))});n.innerHTML="",s.forEach(e=>{let a=document.createElement("li"),c=new Date(e.created_at).toLocaleString("de-DE",{timeZone:"Europe/Berlin"});a.textContent=`${c}: ${e.quantity||1}x ${e.product_name} von ${e.user_name} \u2013 ${e.price?e.price.toFixed(2):""} \u20AC`,n.appendChild(a)})}$().then(t=>{(!t||t.role!=="admin"&&t.role!=="superadmin")&&(window.location.href="/index.html")});var I=document.querySelectorAll("#admin-tabs button"),F=document.querySelectorAll(".tab-content");function T(t){F.forEach(function(n){n.id==="section-"+t?n.style.display="":n.style.display="none"}),I.forEach(function(n){n.classList.toggle("ring-2",n.dataset.tab===t)})}I.forEach(function(t){t.addEventListener("click",function(){T(t.dataset.tab)})});T("products");var L=document.getElementById("logoutBtn");L&&L.addEventListener("click",()=>{fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})});var B;function P(){clearTimeout(B),B=setTimeout(()=>{alert("Session abgelaufen. Du wirst abgemeldet."),fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})},1200*1e3)}["click","keydown","mousemove","touchstart"].forEach(t=>{window.addEventListener(t,P)});P();function _(){var a,c;let t=((c=(a=document.getElementById("user-search"))==null?void 0:a.value)==null?void 0:c.toLowerCase())||"",n=allUsersCache.filter(i=>i.name.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)),s=["Name,Email"];n.forEach(i=>{s.push(`"${i.name.replace(/"/g,'""')}","${i.email.replace(/"/g,'""')}"`)});let r=new Blob([s.join(`
`)],{type:"text/csv"}),o=URL.createObjectURL(r),e=document.createElement("a");e.href=o,e.download="benutzer.csv",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(o)}async function D(t){return new Promise(n=>{window.confirm(t)?n(!0):n(!1)})}var l=window.location.origin,R=null;async function A(){try{let t=await fetch(`${l}/api/user`,{credentials:"include"});t.ok&&(R=(await t.json()).id)}catch(t){console.error("Fehler beim Laden des Benutzers",t)}}async function h(){var o;let t=((o=document.getElementById("category-filter"))==null?void 0:o.value)||"all",s=await(await fetch(`${l}/api/admin/products`,{credentials:"include"})).json(),r=document.getElementById("product-list");r.innerHTML="",s.filter(e=>t==="all"||e.category===t).forEach(e=>{let a=document.createElement("li");a.className="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 p-4 rounded-2xl shadow-md hover:shadow-lg transition-all flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4";let c=e.image_url&&e.image_url.trim()!=="";a.innerHTML=`
      <div class="flex items-center gap-4 flex-1">
        ${c?`<img src="${e.image_url}" alt="${e.name}" class="w-16 h-16 object-contain rounded shadow border border-gray-200 dark:border-gray-700 bg-white" loading="lazy">`:""}
        <div>
          <div class="flex items-center gap-2 mb-1">
            <span class="text-base font-semibold">${e.name}</span>
            <span class="inline-block px-2 py-0.5 rounded text-xs font-bold ${e.available?"bg-green-200 text-green-800 dark:bg-green-700 dark:text-green-200":"bg-red-200 text-red-800 dark:bg-red-700 dark:text-red-200"}">
              ${e.available?"Verf\xFCgbar":"Versteckt"}
            </span>
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-300">
            <span>Preis: <strong>${e.price.toFixed(2)} \u20AC</strong></span> \u2013
            <span>Bestand: <strong>${e.stock}</strong></span> \u2013
            <span>Kategorie: <strong>${e.category||"-"}</strong></span>
          </div>
        </div>
      </div>
      <div class="flex flex-row gap-2 mt-3 sm:mt-0 sm:ml-4">
        <button class="bg-yellow-500 text-white text-xs px-2 py-1 rounded shadow hover:bg-yellow-600 focus:outline-none flex items-center gap-1 toggle-availability-btn" data-id="${e.id}" data-available="${e.available}" title="${e.available?"Verstecken":"Anzeigen"}">
          <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 19l-7-7 7-7' /></svg>
          ${e.available?"Verstecken":"Anzeigen"}
        </button>
        <button class="bg-blue-600 text-white text-xs px-2 py-1 rounded shadow hover:bg-blue-700 focus:outline-none flex items-center gap-1 edit-product-btn" data-id="${e.id}" title="Bearbeiten">
          <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 5h2m-1 0v14m-7-7h14' /></svg>
          Bearbeiten
        </button>
        <button class="bg-red-600 text-white text-xs px-2 py-1 rounded shadow hover:bg-red-700 focus:outline-none flex items-center gap-1 delete-product-btn" data-id="${e.id}" title="L\xF6schen">
          <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12' /></svg>
          L\xF6schen
        </button>
      </div>
    `,r.appendChild(a)}),r.onclick=function(e){let a=e.target.closest(".toggle-availability-btn");if(a){z(a.dataset.id,a.dataset.available==="true");return}let c=e.target.closest(".edit-product-btn");if(c){H(c.dataset.id);return}let i=e.target.closest(".delete-product-btn");if(i){V(i.dataset.id);return}}}async function H(t){let r=(await(await fetch(`${l}/api/admin/products`,{credentials:"include"})).json()).find(i=>i.id===t);if(!r)return;let o={...r},e=document.createElement("div");e.innerHTML=`
    <div class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-md relative">
        <button id="close-edit-dialog" class="absolute top-2 right-2 text-gray-400 hover:text-red-600 text-xl">&times;</button>
        <h2 class="text-lg font-bold mb-4">Produkt bearbeiten</h2>
        <form id="edit-product-form" class="space-y-3">
          <input type="text" id="edit-product-name" value="${r.name}" required class="w-full p-2 rounded border" placeholder="Name" />
          <input type="number" step="0.01" id="edit-product-price" value="${r.price}" required class="w-full p-2 rounded border" placeholder="Verkaufspreis" />
          <input type="number" id="edit-product-stock" value="${r.stock}" required class="w-full p-2 rounded border" placeholder="Bestand" />
          <div>
            <label class="block text-sm mb-1">Bild-URL (optional)</label>
            <input type="url" id="edit-product-image-url" value="${r.image_url||""}" class="block w-full text-sm" placeholder="Bild-URL" />
            <img id="edit-product-image-preview" src="${r.image_url||""}" alt="Vorschau" class="mt-2 max-h-32 rounded shadow${r.image_url?"":" hidden"}" />
          </div>
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Speichern</button>
        </form>
      </div>
    </div>
  `,document.body.appendChild(e),e.querySelector("#close-edit-dialog").onclick=()=>e.remove(),setTimeout(()=>{let i=e.querySelector("input,select,button");i&&i.focus()},50),e.addEventListener("keydown",i=>{i.key==="Escape"&&e.remove()}),e.tabIndex=-1,e.focus();let a=e.querySelector("#edit-product-image-url"),c=e.querySelector("#edit-product-image-preview");a.addEventListener("input",()=>{let i=a.value.trim();i&&/\.(jpg|jpeg|png|webp|gif|svg)$/i.test(i)?(c.src=i,c.classList.remove("hidden")):(c.src="",c.classList.add("hidden"))}),e.querySelector("#edit-product-form").onsubmit=async i=>{i.preventDefault();let u=e.querySelector("#edit-product-name").value,d=e.querySelector("#edit-product-price").value,p=e.querySelector("#edit-product-stock").value,N=a.value.trim(),q=await f();await fetch(`${l}/api/admin/products/${t}`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":q},credentials:"include",body:JSON.stringify({name:u,price:parseFloat(d),stock:parseInt(p),image_url:N})}),e.remove(),m("Produkt bearbeitet.","success",5e3,async()=>{g(!0);let M=await f();await fetch(`${l}/api/admin/products/${t}`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":M},credentials:"include",body:JSON.stringify(o)}),g(!1),m("Bearbeitung r\xFCckg\xE4ngig gemacht!","success"),h(),b()}),h(),b()}}async function z(t,n){let s=await f();await fetch(`${l}/api/admin/products/${t}/available`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":s},credentials:"include",body:JSON.stringify({available:!n})}),h()}async function V(t){if(!await D("Produkt l\xF6schen (K\xE4ufe bleiben erhalten)?"))return;g(!0);let n=await f(),o=(await(await fetch(`${l}/api/admin/products`,{credentials:"include"})).json()).find(a=>a.id===t),e=o?{...o}:null;await fetch(`${l}/api/admin/products/${t}`,{method:"DELETE",credentials:"include",headers:{"x-csrf-token":n}}),g(!1),m("Produkt gel\xF6scht.","success",5e3,async()=>{if(!e)return;g(!0);let a=await f();await fetch(`${l}/api/admin/products`,{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":a},credentials:"include",body:JSON.stringify(e)}),g(!1),m("L\xF6schung r\xFCckg\xE4ngig gemacht!","success"),h(),b(),w(!0)}),h(),b(),w(!0)}async function b(){let t=await fetch(`${l}/api/admin/stats`,{credentials:"include"});if(!t.ok)return;let{users:n,totalBalance:s,shopValue:r,totalRevenue:o,totalCost:e,profit:a}=await t.json();document.getElementById("stats").innerHTML=`
    <p class="mt-4 text-sm"><strong>Produkte im Shop:</strong> ${n.length}</p>
    <p class="text-sm"><strong>Shop-Warenwert:</strong> ${r.toFixed(2)} \u20AC</p>
    <hr class="my-3" />
    <p class="text-sm"><strong>Verkaufserl\xF6se:</strong> ${o.toFixed(2)} \u20AC</p>
    <p class="text-sm"><strong>Einkaufskosten:</strong> ${e.toFixed(2)} \u20AC</p>
    <p class="text-sm"><strong>Gewinn / Verlust:</strong> <span class="${a>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">${a.toFixed(2)} \u20AC</span></p>
    <hr class="my-3" />
    <p class="text-sm"><strong>Gesamtsaldo aller Nutzer:</strong> <span class="${s>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">${s.toFixed(2)} \u20AC</span></p>`}var C=0,S=20;async function w(t=!1){var r;let s=await(await fetch(`${l}/api/admin/purchases?offset=${C}&limit=${S}`,{credentials:"include"})).json();t?(allPurchasesCache=s,y()):(allPurchasesCache=allPurchasesCache.concat(s),y()),C+=S,(r=document.getElementById("purchase-search"))==null||r.addEventListener("input",y)}async function x(){let n=await(await fetch(`${l}/api/admin/users`,{credentials:"include"})).json();allUsersCache=n,E();let s=document.getElementById("user-search");s&&s.addEventListener("input",E);let r=document.getElementById("export-users");r&&r.addEventListener("click",_)}async function J(t,n){let s=null,e=(await(await fetch(`${l}/api/admin/users`,{credentials:"include"})).json()).find(i=>i.id===t);e&&(s={...e});let a=prompt("Neuer Name:",n);if(a&&a.trim()!==""){g(!0);let i=await f(),u=await fetch(`${l}/api/admin/users/${t}`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":i},credentials:"include",body:JSON.stringify({name:a.trim()})});if(g(!1),!u.ok){m("Fehler beim Speichern des Namens","error");return}m("Benutzername ge\xE4ndert.","success",5e3,async()=>{if(!s)return;g(!0);let d=await f();await fetch(`${l}/api/admin/users/${t}`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":d},credentials:"include",body:JSON.stringify({name:s.name})}),g(!1),m("Namens\xE4nderung r\xFCckg\xE4ngig gemacht!","success"),x()})}let c=prompt("Neues Passwort (mind. 6 Zeichen, leer lassen zum \xDCberspringen):");if(c){if(c.length<6)return m("Passwort zu kurz.","error");g(!0);let i=await f(),u=await fetch(`${l}/api/admin/users/${t}/password`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":i},credentials:"include",body:JSON.stringify({password:c})});if(g(!1),!u.ok){m("Fehler beim \xC4ndern des Passworts","error");return}m("Passwort ge\xE4ndert.","success",5e3,async()=>{alert("Das alte Passwort kann aus Sicherheitsgr\xFCnden nicht wiederhergestellt werden.")})}else m("Benutzerdaten gespeichert!","success");x()}async function k(){let n=await(await fetch(`${l}/api/admin/users`,{credentials:"include"})).json(),s=document.getElementById("balance-control-list");s.innerHTML=n.map(o=>{let e=o.balance<0?"text-red-600 dark:text-red-400 font-bold":"text-green-600 dark:text-green-400 font-bold";return`<li class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-xl p-3 shadow-sm mb-2">
      <span class="flex-1 font-semibold">${o.name}: <span class="${e}">${o.balance.toFixed(2)} \u20AC</span></span>
      <div class="flex gap-2 mt-2 sm:mt-0">
        <input type="number" id="bal-${o.id}" class="w-20 border px-2 py-1 rounded" step="0.01" />
        <button class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 flex items-center gap-1 text-xs balance-add-btn" data-id="${o.id}" title="Guthaben erh\xF6hen">
          <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4v16m8-8H4' /></svg>
        </button>
        <button class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 flex items-center gap-1 text-xs balance-sub-btn" data-id="${o.id}" title="Guthaben verringern">
          <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M20 12H4' /></svg>
        </button>
      </div>
    </li>`}).join(""),s.onclick=function(o){let e=o.target.closest(".balance-add-btn");if(e){r(e.dataset.id,"add");return}let a=o.target.closest(".balance-sub-btn");if(a){r(a.dataset.id,"subtract");return}};async function r(o,e){let a=parseFloat(document.getElementById("bal-"+o).value);if(isNaN(a))return m("Ung\xFCltiger Betrag.","error");g(!0);let u=(await(await fetch(`${l}/api/admin/users/${o}`,{credentials:"include"})).json()).balance;e==="add"?u+=a:u-=a;let d=await f();await fetch(`${l}/api/admin/users/${o}`,{method:"PUT",headers:{"Content-Type":"application/json","x-csrf-token":d},credentials:"include",body:JSON.stringify({balance:u})}),g(!1),m("Guthaben aktualisiert.","success"),k(),b()}}async function G(){let n=await(await fetch(`${l}/api/admin/users`,{credentials:"include"})).json(),s=document.getElementById("buy-user");s&&(s.innerHTML=n.map(r=>`<option value="${r.id}">${r.name}</option>`).join(""))}var v=[];function j(t){let n=document.getElementById("buy-product-list");n&&(n.innerHTML="",t.forEach(s=>{let r=document.createElement("div");r.className="border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-xl p-4 shadow flex flex-col items-center",r.innerHTML=`
      ${s.image_url?`<img src="${s.image_url}" alt="${s.name}" class="w-20 h-20 object-contain mb-2 rounded shadow">`:""}
      <div class="font-semibold text-center mb-1">${s.name}</div>
      <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">${s.price.toFixed(2)} \u20AC</div>
      <div class="text-xs text-gray-500 mb-2">Bestand: ${s.stock}</div>
      <div class="flex gap-1 items-center mb-2">
        <input type="number" min="1" max="${s.stock}" value="1" class="buy-qty-input p-1 border rounded w-14 text-center" aria-label="Menge" />
      </div>
      <button class="buy-for-user-btn btn-main bg-blue-600 text-white px-3 py-1 rounded shadow hover:bg-blue-700 w-full" data-product-id="${s.id}" ${s.stock<1?"disabled":""}>Kaufen</button>
    `,n.appendChild(r)}))}async function U(){v=(await(await fetch(`${l}/api/admin/products`,{credentials:"include"})).json()).filter(s=>s.available&&s.stock>0),j(v)}function K(){var s,r;let t=((r=(s=document.getElementById("buy-product-search"))==null?void 0:s.value)==null?void 0:r.toLowerCase())||"",n=v.filter(o=>o.name.toLowerCase().includes(t)||o.category&&o.category.toLowerCase().includes(t));j(n)}async function Z(t,n){var i;let s=document.getElementById("buy-user"),r=s==null?void 0:s.value;if(!r||!t||isNaN(n)||n<=0)return;let o=await f(),e=await fetch(`${l}/api/admin/buy`,{method:"POST",headers:{"Content-Type":"application/json","x-csrf-token":o},credentials:"include",body:JSON.stringify({user_id:r,product_id:t,quantity:n})}),a=await e.json(),c=document.getElementById("buy-for-user-result");if(e.ok){let u=((i=s.options[s.selectedIndex])==null?void 0:i.textContent)||"";c.textContent="",m(`Kauf f\xFCr ${u} erfolgreich!`,"success",3500),document.getElementById("buy-product-search").value="",document.querySelectorAll(".buy-qty-input").forEach(d=>d.value=1),b(),h(),k(),U()}else c.textContent=a.error||"Fehler",m(a.error||"Fehler beim Kauf","error",4e3)}window.addEventListener("DOMContentLoaded",()=>{var t,n,s;A(),b(),h(),w(!0),x(),k(),G(),U(),(t=document.getElementById("export-purchases"))==null||t.addEventListener("click",O),(n=document.getElementById("buy-product-search"))==null||n.addEventListener("input",K),(s=document.getElementById("buy-product-list"))==null||s.addEventListener("click",function(r){if(r.target.classList.contains("buy-for-user-btn")){let o=r.target.closest("div"),e=r.target.getAttribute("data-product-id"),a=o.querySelector(".buy-qty-input"),c=parseInt(a.value||"1");Z(e,c)}}),typeof startSessionCheck=="function"&&startSessionCheck()});window.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("faq-btn"),n=document.getElementById("faq-overlay"),s=document.getElementById("faq-close");t&&n&&s&&(t.addEventListener("click",()=>{n.classList.remove("hidden"),s.focus()}),s.addEventListener("click",()=>{n.classList.add("hidden"),t.focus()}),n.addEventListener("click",d=>{d.target===n&&(n.classList.add("hidden"),t.focus())}),document.addEventListener("keydown",d=>{!n.classList.contains("hidden")&&(d.key==="Escape"||d.key==="Esc")&&(n.classList.add("hidden"),t.focus())}));let r=document.getElementById("darkModeBtn");r&&r.addEventListener("click",()=>{let d=document.documentElement.classList.toggle("dark");localStorage.setItem("darkMode",d?"true":"false")}),localStorage.getItem("darkMode")===null?(document.documentElement.classList.add("dark"),localStorage.setItem("darkMode","true")):localStorage.getItem("darkMode")!=="false"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");let o=document.querySelectorAll("#admin-tabs button[data-tab]"),e=document.querySelectorAll(".tab-content");function a(d){e.forEach(function(p){p.id==="section-"+d?p.style.display="":p.style.display="none"}),o.forEach(function(p){p.classList.toggle("ring-2",p.dataset.tab===d)})}o.forEach(function(d){d.addEventListener("click",function(){a(d.dataset.tab)})}),a("products");let c=document.getElementById("logoutBtn");c&&c.addEventListener("click",()=>{fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})});let i;function u(){clearTimeout(i),i=setTimeout(()=>{alert("Session abgelaufen. Du wirst abgemeldet."),fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})},1200*1e3)}["click","keydown","mousemove","touchstart"].forEach(d=>{window.addEventListener(d,u)}),u()});})();
