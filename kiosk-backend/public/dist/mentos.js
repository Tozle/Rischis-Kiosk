(()=>{var b=Object.defineProperty;var v=(t,e)=>()=>(t&&(e=t(t=0)),e);var C=(t,e)=>{for(var n in e)b(t,n,{get:e[n],enumerable:!0})};var x={};C(x,{getCurrentUser:()=>B});async function B(){try{let e=await(await fetch("/api/auth/me",{credentials:"include"})).json();return e.loggedIn&&e.user?e.user:null}catch(t){return null}}var L=v(()=>{});var u=t=>document.getElementById(t);async function m(){try{return(await(await fetch(`${window.location.origin}/api/csrf-token`,{credentials:"include"})).json()).csrfToken}catch(t){return console.error("CSRF-Token konnte nicht geladen werden",t),null}}function d(t,e="success",n=3e3,s=null){let o=document.getElementById("toast");if(!o)return;o.innerHTML="";let r=document.createElement("span");if(r.textContent=t,o.appendChild(r),s){let i=document.createElement("button");i.textContent="R\xFCckg\xE4ngig",i.className="ml-4 px-3 py-1 rounded bg-white/80 text-green-700 font-bold shadow hover:bg-green-100 transition text-xs",i.onclick=()=>{s(),o.classList.add("opacity-0")},o.appendChild(i)}o.className=`fixed left-1/2 top-6 z-50 -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-center text-sm font-semibold transition-opacity duration-300 pointer-events-none ${e==="error"?"bg-red-600":"bg-green-600"} text-white opacity-100`,s||setTimeout(()=>{o.classList.add("opacity-0")},n)}function E(t){return`${Math.floor(t/3600)} Std.`}var p=window.location.origin,g=u("feedings-body"),k=u("last-feed");async function h(){try{let e=await(await fetch(`${p}/api/feedings`)).json();if(g.innerHTML="",e.forEach(n=>{let s=document.createElement("tr");s.innerHTML=`
                <td class="px-2 py-1">${new Date(n.zeitstempel).toLocaleString("de-DE")}</td>
                <td class="px-2 py-1">${n.futterart==="nass"?"Nassfutter":n.futterart==="trocken"?"Trockenfutter":n.futterart}</td>
                <td class="px-2 py-1">${n.gefuettert_von||"-"}</td>
            `,g.appendChild(s)}),e.length>0){let n=e[0],s=Math.floor((Date.now()-new Date(n.zeitstempel))/1e3);k.textContent=E(s)}else k.textContent="-"}catch(t){g.innerHTML='<tr><td colspan="3" class="text-red-600">Fehler beim Laden</td></tr>'}}async function T(t){let e=t==="Nassfutter"?btnNass:btnTrocken;e.disabled=!0,e.classList.add("opacity-60"),e.textContent="...";try{let n=await m(),s=await fetch(`${p}/api/feedings`,{method:"POST",headers:{"Content-Type":"application/json","CSRF-Token":n},credentials:"include",body:JSON.stringify({type:t})});if(!s.ok){let o="Fehler beim Eintragen!";try{let r=await s.json();r&&r.error&&(o+=`
${r.error}`)}catch(r){}throw new Error(o)}await h(),d("F\xFCtterung gespeichert!","success")}catch(n){d(n.message||"Fehler beim Eintragen!","error")}finally{e.disabled=!1,e.classList.remove("opacity-60"),e.textContent=t==="Nassfutter"?"\u{1F41F} Nassfutter gegeben":"\u{1F963} Trockenfutter gegeben"}}document.addEventListener("DOMContentLoaded",()=>{h();let t=document.getElementById("btn-nass"),e=document.getElementById("btn-trocken");t&&t.addEventListener("click",()=>T("Nassfutter")),e&&e.addEventListener("click",()=>T("Trockenfutter")),Promise.resolve().then(()=>(L(),x)).then(({getCurrentUser:a})=>{a().then(l=>{if(l&&(l.role==="admin"||l.role==="superadmin")){let w=document.getElementById("admin-buttons");w&&w.classList.remove("hidden");let c=document.getElementById("clear-history-btn");c&&c.addEventListener("click",async()=>{if(confirm("M\xF6chtest du wirklich den gesamten F\xFCtterungsverlauf unwiderruflich l\xF6schen?")){c.disabled=!0,c.textContent="...";try{let f=await m();if(!(await fetch(`${p}/api/feedings`,{method:"DELETE",headers:{"CSRF-Token":f},credentials:"include"})).ok)throw new Error("Fehler beim L\xF6schen!");d("Verlauf gel\xF6scht!","success"),await h()}catch(f){d(f.message||"Fehler beim L\xF6schen!","error")}finally{c.disabled=!1,c.textContent="\u{1F5D1}\uFE0F Anzeige l\xF6schen"}}})}})});let n=document.getElementById("faq-btn"),s=document.getElementById("faq-overlay"),o=document.getElementById("faq-close");n&&s&&o&&(n.addEventListener("click",()=>{s.classList.remove("hidden"),o.focus()}),o.addEventListener("click",()=>{s.classList.add("hidden"),n.focus()}),s.addEventListener("click",a=>{a.target===s&&(s.classList.add("hidden"),n.focus())}),document.addEventListener("keydown",a=>{!s.classList.contains("hidden")&&(a.key==="Escape"||a.key==="Esc")&&(s.classList.add("hidden"),n.focus())}));let r=document.getElementById("logoutBtn");r&&r.addEventListener("click",()=>{fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})});let i;function y(){clearTimeout(i),i=setTimeout(()=>{alert("Session abgelaufen. Du wirst abgemeldet."),fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})},1200*1e3)}["click","keydown","mousemove","touchstart"].forEach(a=>{window.addEventListener(a,y)}),y()});})();
