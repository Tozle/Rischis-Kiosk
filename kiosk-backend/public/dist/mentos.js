(()=>{var b=Object.defineProperty;var v=(n,t)=>()=>(n&&(t=n(n=0)),t);var T=(n,t)=>{for(var e in t)b(n,e,{get:t[e],enumerable:!0})};var k={};T(k,{getCurrentUser:()=>S});async function S(){try{let t=await(await fetch("/api/auth/me",{credentials:"include"})).json();return t.loggedIn&&t.user?t.user:null}catch(n){return null}}var E=v(()=>{});function x(){let n=document.documentElement.classList.toggle("dark");localStorage.setItem("darkMode",n?"true":"false")}localStorage.getItem("darkMode")!=="false"&&document.documentElement.classList.add("dark");document.addEventListener("DOMContentLoaded",()=>{let n=document.getElementById("darkmode-toggle-btn");n&&n.addEventListener("click",x)});var u=window.location.origin,g=document.getElementById("feedings-body"),p=document.getElementById("last-feed"),c=document.getElementById("btn-nass"),i=document.getElementById("btn-trocken");async function h(){try{let t=await(await fetch(`${u}/api/feedings`)).json();if(g.innerHTML="",t.forEach(e=>{let s=document.createElement("tr");s.innerHTML=`
                <td class="px-2 py-1">${new Date(e.zeitstempel).toLocaleString("de-DE")}</td>
                <td class="px-2 py-1">${e.futterart==="nass"?"Nassfutter":e.futterart==="trocken"?"Trockenfutter":e.futterart}</td>
                <td class="px-2 py-1">${e.gefuettert_von||"-"}</td>
            `,g.appendChild(s)}),t.length>0){let e=t[0],s=Math.floor((Date.now()-new Date(e.zeitstempel))/1e3);p.textContent=B(s)}else p.textContent="-"}catch(n){g.innerHTML='<tr><td colspan="3" class="text-red-600">Fehler beim Laden</td></tr>'}}async function w(){try{return(await(await fetch(`${u}/api/csrf-token`,{credentials:"include"})).json()).csrfToken}catch(n){return console.error("CSRF-Token konnte nicht geladen werden",n),null}}function B(n){return`${Math.floor(n/3600)} Std.`}function l(n,t="success"){let e=document.getElementById("mentos-toast");e||(e=document.createElement("div"),e.id="mentos-toast",e.style.position="fixed",e.style.top="2rem",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.zIndex="9999",e.style.padding="1rem 2rem",e.style.borderRadius="1rem",e.style.fontWeight="bold",e.style.fontSize="1.1rem",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",document.body.appendChild(e)),e.textContent=n,e.style.background=t==="success"?"#22c55e":"#ef4444",e.style.color="white",e.style.opacity="1",setTimeout(()=>{e.style.opacity="0"},2500)}async function L(n){let t=n==="Nassfutter"?c:i;t.disabled=!0,t.classList.add("opacity-60"),t.textContent="...";try{let e=await w(),s=await fetch(`${u}/api/feedings`,{method:"POST",headers:{"Content-Type":"application/json","CSRF-Token":e},credentials:"include",body:JSON.stringify({type:n})});if(!s.ok){let r="Fehler beim Eintragen!";try{let a=await s.json();a&&a.error&&(r+=`
${a.error}`)}catch(a){}throw new Error(r)}await h(),l("F\xFCtterung gespeichert!","success")}catch(e){l(e.message||"Fehler beim Eintragen!","error")}finally{t.disabled=!1,t.classList.remove("opacity-60"),t.textContent=n==="Nassfutter"?"\u{1F41F} Nassfutter gegeben":"\u{1F963} Trockenfutter gegeben"}}c==null||c.addEventListener("click",()=>L("Nassfutter"));i==null||i.addEventListener("click",()=>L("Trockenfutter"));document.addEventListener("DOMContentLoaded",()=>{h(),Promise.resolve().then(()=>(E(),k)).then(({getCurrentUser:o})=>{o().then(m=>{if(m&&(m.role==="admin"||m.role==="superadmin")){let y=document.getElementById("admin-buttons");y&&y.classList.remove("hidden");let d=document.getElementById("clear-history-btn");d&&d.addEventListener("click",async()=>{if(confirm("M\xF6chtest du wirklich den gesamten F\xFCtterungsverlauf unwiderruflich l\xF6schen?")){d.disabled=!0,d.textContent="...";try{let f=await w();if(!(await fetch(`${u}/api/feedings`,{method:"DELETE",headers:{"CSRF-Token":f},credentials:"include"})).ok)throw new Error("Fehler beim L\xF6schen!");l("Verlauf gel\xF6scht!","success"),await h()}catch(f){l(f.message||"Fehler beim L\xF6schen!","error")}finally{d.disabled=!1,d.textContent="\u{1F5D1}\uFE0F Anzeige l\xF6schen"}}})}})});let n=document.getElementById("faq-btn"),t=document.getElementById("faq-overlay"),e=document.getElementById("faq-close");n&&t&&e&&(n.addEventListener("click",()=>{t.classList.remove("hidden"),e.focus()}),e.addEventListener("click",()=>{t.classList.add("hidden"),n.focus()}),t.addEventListener("click",o=>{o.target===t&&(t.classList.add("hidden"),n.focus())}),document.addEventListener("keydown",o=>{!t.classList.contains("hidden")&&(o.key==="Escape"||o.key==="Esc")&&(t.classList.add("hidden"),n.focus())})),localStorage.getItem("darkMode")===null?(document.documentElement.classList.add("dark"),localStorage.setItem("darkMode","true")):localStorage.getItem("darkMode")!=="false"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");let s=document.getElementById("logoutBtn");s&&s.addEventListener("click",()=>{fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})});let r;function a(){clearTimeout(r),r=setTimeout(()=>{alert("Session abgelaufen. Du wirst abgemeldet."),fetch("/api/logout",{method:"POST",credentials:"include"}).finally(()=>{sessionStorage.clear(),window.location.href="/index.html"})},1200*1e3)}["click","keydown","mousemove","touchstart"].forEach(o=>{window.addEventListener(o,a)}),a()});})();
